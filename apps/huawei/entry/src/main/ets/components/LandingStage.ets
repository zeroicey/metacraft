/**
 * Stageç»„ä»¶ä½¿ç”¨æ–¹æ³•å¤‡ä»½ï¼ˆæš‚ä¸ä½¿ç”¨ï¼Œä»…ä¾›å‚è€ƒï¼‰
 *
 * 1. LandingStage è½åœ°é¡µ
 *    LandingStage({
 *      onStart: () => {
 *        // ç‚¹å‡»å¼€å§‹åˆ›å»ºæŒ‰é’®
 *      },
 *      onSelectInspiration: (name: string, desc: string) => {
 *        // é€‰æ‹©çµæ„Ÿèƒ¶å›Š
 *      }
 *    })
 *
 * 2. InceptionStage åˆå§‹é˜¶æ®µï¼ˆå‘½åå’Œæè¿°ï¼‰
 *    InceptionStage({
 *      appName: this.appName,
 *      appDesc: this.appDesc,
 *      onAppNameChange: (value: string) => {
 *        this.appName = value;
 *      },
 *      onAppDescChange: (value: string) => {
 *        this.appDesc = value;
 *      },
 *      onNext: () => {
 *        // ä¸‹ä¸€æ­¥
 *      }
 *    })
 *
 * 3. BlueprintStage è“å›¾é˜¶æ®µï¼ˆè§„åˆ’ç¡®è®¤ï¼‰
 *    BlueprintStage({
 *      appName: this.appName,
 *      planText: this.planText,
 *      onPlanTextChange: (value: string) => {
 *        this.planText = value;
 *      },
 *      onBack: () => {
 *        // è¿”å›žä¸Šä¸€æ­¥
 *      },
 *      onBuild: () => {
 *        // ç«‹å³ç”Ÿæˆ
 *      }
 *    })
 *
 * 4. WorkspaceStage å·¥ä½œåŒºé˜¶æ®µï¼ˆé¢„è§ˆå’Œè¿è¡Œï¼‰
 *    WorkspaceStage({
 *      appName: this.appName,
 *      onRunPreview: () => {
 *        // è¿è¡Œé¢„è§ˆ
 *      }
 *    })
 */

@ComponentV2
export struct LandingStage {
  @Event onStart: () => void;
  @Event onSelectInspiration: (name: string, desc: string) => void;
  @Local displayText: string = '';
  @Local currentTextIndex: number = 0;
  private textOptions: string[] = [
    'ä»Šå¤©æƒ³æŠŠä»€ä¹ˆæƒ³æ³•å˜æˆçŽ°å®žï¼Ÿ',
    'å‡†å¤‡å¥½åˆ›é€ ä¸€äº›ä»¤äººæƒŠå¹çš„ä¸œè¥¿äº†å—ï¼Ÿ',
    'è®©æˆ‘ä»¬ä¸€èµ·å°†æƒ³è±¡åŠ›è½¬åŒ–ä¸ºçŽ°å®žï¼',
    'æœ‰ä»€ä¹ˆçµæ„Ÿæƒ³è¦å®žçŽ°å—ï¼Ÿ',
    'å¼€å§‹ä½ çš„åˆ›ä½œä¹‹æ—…å§ï¼'
  ];
  private typewriterTimer: number = -1;

  aboutToAppear(): void {
    this.startTypewriter();
  }

  aboutToDisappear(): void {
    if (this.typewriterTimer !== -1) {
      clearInterval(this.typewriterTimer);
    }
  }

  private startTypewriter(): void {
    const text = this.textOptions[this.currentTextIndex];
    let charIndex = 0;
    this.displayText = '';

    this.typewriterTimer = setInterval(() => {
      if (charIndex < text.length) {
        this.displayText += text[charIndex];
        charIndex++;
      } else {
        clearInterval(this.typewriterTimer);
        // 3ç§’åŽåˆ‡æ¢åˆ°ä¸‹ä¸€å¥
        setTimeout(() => {
          this.currentTextIndex = (this.currentTextIndex + 1) % this.textOptions.length;
          this.startTypewriter();
        }, 3000);
      }
    }, 80);
  }

  build() {
    Column({ space: 16 }) {
      Blank().layoutWeight(1)
  
      // æ¬¢è¿ŽåŒº
      Column({ space: 8 }) {
        Text('Hiï¼Œåˆ›ä½œè€…')
          .fontSize(28)
          .fontWeight(FontWeight.Bold)
          .width('100%')
          .textAlign(TextAlign.Start)
      
        Text(this.displayText)
          .fontSize(16)
          .fontColor('#888888')
          .height(24)
          .width('100%')
          .textAlign(TextAlign.Start)
      }
      .width('90%')
      .alignItems(HorizontalAlign.Start)
      
      // çµæ„Ÿèƒ¶å›Š - æµå¼é”™è½å¸ƒå±€
      Flex({ wrap: FlexWrap.Wrap, justifyContent: FlexAlign.Start }) {
        this.buildInspirationChip('â²ï¸ å®šåˆ¶ç•ªèŒ„é’Ÿ', 'ä¸€ä¸ªæ”¯æŒç•ªèŒ„å·¥ä½œæ³•çš„ä¸“æ³¨è®¡æ—¶å™¨');
        this.buildInspirationChip('ðŸŽ² çŽ©æ¸¸æˆ', 'ä¸€ä¸ªç®€å•çš„æŠ•éª°å­å°æ¸¸æˆï¼Œæ”¯æŒè®¡åˆ†å’Œè§„åˆ™è‡ªå®šä¹‰');
        this.buildInspirationChip('ðŸŽ¨ åˆ¶ä½œè°ƒè‰²æ¿', 'ä¸€ä¸ªç”¨äºŽé…è‰²æ–¹æ¡ˆè®¾è®¡çš„è°ƒè‰²æ¿åº”ç”¨');
        this.buildInspirationChip('ðŸ“ å¿«é€Ÿè®°äº‹æœ¬', 'ä¸€ä¸ªç”¨äºŽå¿«é€Ÿè®°å½•çµæ„Ÿå’Œå¾…åŠžçš„æžç®€å¤‡å¿˜å½•');
        this.buildInspirationChip('ðŸŽµ å™ªéŸ³æœº', 'æä¾›å¤šç§çŽ¯å¢ƒéŸ³å¸®åŠ©ä¸“æ³¨å’Œæ”¾æ¾');
        this.buildInspirationChip('ðŸ“Š ä¹ æƒ¯è¿½è¸ªå™¨', 'å¸®åŠ©ä½ åŸ¹å…»å¥½ä¹ æƒ¯çš„è¿½è¸ªè®°å½•å·¥å…·');
      }
      .width('100%')
      .margin({ top: 20 })
  
      Blank().layoutWeight(1)
  
      // å¯åŠ¨å…¥å£æŒ‰é’®
      Button('+ å¼€å§‹åˆ›å»ºä¸€ä¸ªæ–°å…ƒåº”ç”¨')
        .width('100%')
        .height(48)
        .backgroundColor($r('sys.color.ohos_id_color_emphasize'))
        .margin({ bottom: 24 })
        .onClick(() => {
          this.onStart();
        })
    }
  }

  @Builder
  private buildInspirationChip(label: string, desc: string) {
    Button(label)
      .height(40)
      .padding({ left: 16, right: 16 })
      .margin({ right: 8, bottom: 15 })
      .backgroundColor('#F5F5F5')
      .fontColor('#333333')
      .borderRadius(20)
      .onClick(() => {
        this.onSelectInspiration(label, desc);
      })
  }
}
